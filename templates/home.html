{% extends "base.html" %}
{% block title %}–ì–ª–∞–≤–Ω–∞—è{% endblock %}

{% block content %}
<section class="content-section">
    <!-- –ë–ê–ù–ù–ï–† -->
    
    <!-- –°–ï–ö–¶–ò–Ø 3D + –°–ö–ò–î–ö–ò -->
    
    <div class="main-section">
        <!-- 3D-–º–æ–¥–µ–ª—å -->
        <div class="model-block">
            <div class="pricing-plan">3D-–º–æ–¥–µ–ª—å</div>
            <model-viewer
                src="{{ url_for('static', filename='models/model.glb') }}"
                alt="3D –º–æ–¥–µ–ª—å"
                auto-rotate
                camera-controls
                disable-zoom
                animation-name: spin;
animation-duration: 30s;
animation-iteration-count: infinite;
                style="width: 310px; height: 350px;"
                ar
                ar-modes="webxr scene-viewer quick-look"
                environment-image="neutral"
                shadow-intensity="1"
                exposure="1">
            </model-viewer>
            <button class="price-value" onclick="window.location.href='{{ url_for('generate_avatar') }}'">–°–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –∞–≤–∞—Ç–∞—Ä</button>
        </div>
        
        <!-- –ë–ª–æ–∫ —Å–∫–∏–¥–æ–∫ -->
        <div class="discounts-wrapper">
            <div class="discount-column">
                <div class="discount-card small"><img src="/static/images/discount1.jpg" alt="–°–∫–∏–¥–∫–∞ 1"></div>
                <div class="discount-card small"><img src="/static/images/discount4.jpg" alt="–°–∫–∏–¥–∫–∞ 4"></div>
            </div>
            
            <div class="discount-card large center-card"><img src="/static/images/discount2.jpg" alt="–°–∫–∏–¥–∫–∞ 2"></div>
            
            <div class="discount-column">
                <div class="discount-card small"><img src="/static/images/discount3.jpg" alt="–°–∫–∏–¥–∫–∞ 3"></div>
                <div class="discount-card small"><img src="/static/images/discount5.jpg" alt="–°–∫–∏–¥–∫–∞ 5"></div>
            </div>
            
            <div class="discount-card large center-card"><img src="/static/images/discount6.jpg" alt="–°–∫–∏–¥–∫–∞ 6"></div>
            
            <div class="discount-column">
                <div class="discount-card small"><img src="/static/images/discount7.jpg" alt="–°–∫–∏–¥–∫–∞ 7"></div>
                <div class="discount-card small"><img src="/static/images/discount8.jpg" alt="–°–∫–∏–¥–∫–∞ 8"></div>
            </div>
        </div>
    </div>
    
    <div class="main-section" style="gap: 60px; align-items: stretch;">
      <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –æ–ø–∏—Å–∞–Ω–∏–µ -->
      <div style="display: flex; flex-direction: column; gap: 30px; flex: 1;">
      <div class="neo-title-section">
        <h1 class="neo-title">üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ 3D –º–æ–¥–µ–ª–∏</h1>
      </div>
      <div style="flex: 1; display: flex; flex-direction: column; justify-content: center;">
        <h2 style="font-size: 28px; font-weight: bold; margin-bottom: 20px;">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h2>
        <p style="font-size: 16px; line-height: 1.6;">
          –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –≤–∞—à–µ–π –æ–¥–µ–∂–¥—ã, –∏ —Å–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—Å—Ç 3D-–º–æ–¥–µ–ª—å. <br>
          –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ —Å–∫–∞—á–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π .glb-—Ñ–∞–π–ª –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ –ª—é–±—ã—Ö 3D-–ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫–∞—Ö –∏–ª–∏ AR-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.
        </p>
      </div>
      <div class="neo-guide-block">
        <button class="brutal-button" onclick="showRecommendations()" data-content="–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫ —Ñ–æ—Ç–æ">
          <span class="button_top">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫ —Ñ–æ—Ç–æ</span>
        </button>
      </div>
      <div id="recommendation-popup" class="popup hidden">
        <div class="popup-content">
          <h3>üì∏ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫ —Ñ–æ—Ç–æ</h3>
          <ul>
            <li>‚Ä¢ –§–æ—Ç–æ –Ω–∞ –±–µ–ª–æ–º –∏–ª–∏ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–º —Ñ–æ–Ω–µ</li>
            <li>‚Ä¢ –ë–µ–∑ —Å–∏–ª—å–Ω—ã—Ö —Ç–µ–Ω–µ–π –∏ –±–ª–∏–∫–æ–≤</li>
            <li>‚Ä¢ –¶–µ–ª—å–Ω—ã–π —Å–∏–ª—É—ç—Ç –±–µ–∑ –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤</li>
            <li>‚Ä¢ –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</li>
          </ul>
          <button class="brutal-button" onclick="hideRecommendations()" data-content="–ó–∞–∫—Ä—ã—Ç—å">
            <span class="button_top">–ó–∞–∫—Ä—ã—Ç—å</span>
          </button>
        </div>
      </div>
      </div>
      <style>
/* === –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø –°–¢–ò–õ–ï–ô === */

@media (max-width: 768px) {
  body {
    scroll-behavior: smooth;
    -webkit-tap-highlight-color: transparent;
  }

  button, .neo-button, .brutal-button {
    transition: all 0.3s ease-in-out;
    touch-action: manipulation;
  }

  /* –¶–µ–Ω—Ç—Ä–æ–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ –∏ –∫–Ω–æ–ø–æ–∫ */
  .neo-title-section, .neo-guide-block, .result-block {
    text-align: center;
  }

  /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –ø–æ–º–µ–Ω—å—à–µ –∏ —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏ */
  .neo-title {
    font-size: 24px !important;
    text-align: center;
    margin: 0 auto 20px auto;
  }

  h2 {
    font-size: 30px !important;
    text-align: center;
  }

  /* –ö–Ω–æ–ø–∫–∏ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
  .brutal-button,
  .neo-button {
    width: 100% !important;
    font-size: 16px;
  }

  /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π */
  #recommendation-popup .popup-content {
    width: 100vw !important;
    height: 100vh !important;
    max-width: none;
    max-height: none;
    top: 0 !important;
    left: 0 !important;
    border-radius: 0 !important;
    padding: 30px 20px;
    box-sizing: border-box;
    overflow-y: auto;
  }

  /* Neo-window: –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∏ –æ—Ç—Å—Ç—É–ø */
  .neo-window {
    width: 100% !important;
    margin-top: 20px;
  }

  /* –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –º–æ–¥–µ–ª–∏ */
  model-viewer {
    width: 100% !important;
    height: 350px !important;
    max-width: 320px;
    margin: 0 auto;
  }

  /* 1. –°–æ–∑–¥–∞–Ω–∏–µ 3D –º–æ–¥–µ–ª–∏ ‚Äî –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
  .main-section {
    flex-direction: column !important;
    gap: 40px !important;
    align-items: center !important;
  }

  /* 2. –£–º–µ–Ω—å—à–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –∞—Ç–µ–ª—å–µ */
  .hero-banner {
    background-size: contain !important;
    height: 110px !important; /* –£–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ */
    background-position: center !important;
  }

  /* 3. –ö–∞—Ä—É—Å–µ–ª—å –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
  .carousel-section {
    overflow: hidden;
    width: 100vw;
    padding: 0 10px;
    box-sizing: border-box;
  }

  .carousel-container {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    gap: 12px;
    padding: 10px 0;
  }

  .carousel-product-card {
    scroll-snap-align: start;
    flex: 0 0 auto;
    width: 160px !important;
  }

  .carousel-btn {
    display: none !important;
  }

  /* –£–±–∏—Ä–∞–µ–º –±–ª–æ–∫ —Å–æ —Å–∫–∏–¥–∫–∞–º–∏ */
  .discounts-wrapper {
    display: none !important;
  }

  /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –ø–æ–¥–ø—Ä–∞–≤–∏–º 3D –º–æ–¥–µ–ª—å –ø–æ –æ—Ç—Å—Ç—É–ø–∞–º */
  .model-block {
    padding-top: 30px !important;
    display: block !important;
    width: 100% !important;
  }

  /* –£–±–∏—Ä–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —à–∏—Ä–∏–Ω—É —É neo-window */
  .neo-window {
    width: 100% !important;
    box-sizing: border-box;
  }

  /* –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –±–ª–æ–∫ –ø–æ–¥–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤ */
  .looks-grid {
    grid-template-columns: 1fr !important;
    gap: 20px;
  }

  .look-card {
    width: 100% !important;
  }

  /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ */
  .file-input {
    width: 100% !important;
    box-sizing: border-box;
  }

  input[type="file"] {
    width: 100% !important;
    box-sizing: border-box;
  }
}



      .neo-window {
        width: 450px;
        background: #BC2649;
        border: 4px solid #000000;
        box-shadow: 12px 12px 0 #000000;
        padding: 0;
      }

      .neo-header {
        background: #FFFFFF;
        color: #000000;
        padding: 10px 20px;
        font-weight: 900;
        font-size: 18px;
        border-bottom: 4px solid #000000;
      }

      .neo-content {
        padding: 20px;
        color: #FFFFFF;
        font-size: 15px;
        font-weight: 600;
      }

      .file-input {
        margin-top: 10px;
        margin-bottom: 20px;
      }

      input[type="file"] {
        background-color: #FFFFFF;
        border: 2px solid #000000;
        padding: 5px;
        font-weight: 600;
        color: #000000;
        margin-bottom: 10px;
      }

      .neo-button {
        display: inline-block;
        padding: 10px 20px;
        background: #CACCCB;
        border: 3px solid #000000;
        color: #000000;
        font-weight: bold;
        text-decoration: none;
        box-shadow: 5px 5px 0 #000000;
        transition: all 0.2s ease;
        margin-top: 15px;
      }

      .neo-button:hover {
        translate: 2px 2px;
        box-shadow: 2px 2px 0 #000000;
      }

      .neo-button:active {
        translate: 4px 4px;
        box-shadow: none;
      }

      .result-block {
        margin-top: 20px;
        background-color: #FFFFFF;
        color: #000000;
        border: 3px solid #000000;
        box-shadow: 8px 8px 0 #000000;
        padding: 15px;
        font-weight: 700;
      }

      .result-block.error {
        background-color: #BC2649;
        color: #FFFFFF;
        border: 3px solid #000000;
        box-shadow: 8px 8px 0 #000000;
      }

      .carousel-container {
  display: flex;
  overflow-x: auto;
  scroll-behavior: smooth;
  gap: 20px;
  padding: 20px 0;
  flex-wrap: nowrap; /* üîê –∑–∞–ø—Ä–µ—Ç –Ω–∞ –ø–µ—Ä–µ–Ω–æ—Å */
}

.carousel-product-card {
  flex: 0 0 auto; /* üîí –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è –∏ –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è */
  width: 200px;
  height: 320px;
  border: 3px solid black;
  box-shadow: 6px 6px 0 black;
  padding: 10px;
  background: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-right: 20px;
  transition: transform 0.3s ease;
}

.carousel-product-card:hover {
  transform: scale(1.03);
}

.carousel-img-card {
  width: 100%;
  height: 200px;
  background-color: #f5f5f5;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  margin-bottom: 10px;
}

.carousel-img-card img {
  width: 100%;
  height: auto;
  object-fit: contain;
}

.carousel-info-card {
  text-align: center;
  font-weight: bold;
  margin-bottom: 10px;
}

.carousel-add-cart {
  padding: 6px 12px;
  background-color: black;
  color: white;
  border: none;
  cursor: pointer;
  font-weight: 700;
  box-shadow: 4px 4px 0 black;
  transition: all 0.3s ease;
}
.modal-buttons {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 25px;
}

#modal-cart-btn.added {
  background-color: var(--magenta) !important;
  color: var(--white) !important;
}
.carousel-add-cart:hover {
  background-color: var(--magenta);
  transform: translate(2px, 2px);
  box-shadow: 2px 2px 0 black;
}
.looks-section {
  width: 100vw;
  margin-left: calc(-50vw + 50%);
  padding: 60px 20px;
  box-sizing: border-box;
  background: radial-gradient(
    ellipse at center,
    rgba(188, 38, 73, 0.1) 0%,
    rgba(255, 255, 255, 0.96) 100%
  );
  border-top: 2px solid var(--light-gray);
  border-bottom: 2px solid var(--light-gray);
  opacity: 0;
  transform: translateY(50px);
  transition: all 1s ease;
}

.looks-section.visible {
  opacity: 1;
  transform: translateY(0);
}
@media (max-width: 768px) {
  header .burger,
  header .user-actions {
    display: none !important;
  }

  footer .burger,
  footer .user-actions {
    display: none !important;
  }
}
      </style>
      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const section = document.querySelector('.looks-section');
        
          const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                section.classList.add('visible');
                observer.disconnect(); // —á—Ç–æ–±—ã –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–ª–æ—Å—å
              }
            });
          }, {
            threshold: 0.1
          });
        
          observer.observe(section);
        });
        </script>
      <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –æ–∫–Ω–æ –∑–∞–≥—Ä—É–∑–∫–∏ -->
       
      <div class="neo-window">
        <div class="neo-header">üì∏ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ 3D-–º–æ–¥–µ–ª–∏</div>
        <div class="neo-content">
          <form method="POST" enctype="multipart/form-data">
            <div class="file-input">
              <input type="file" name="image" required>
            </div>
            <button class="neo-button" type="submit">‚ú® –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          </form>

          {% if model_url %}
          <div class="result-block">
            <h3>‚úÖ –ú–æ–¥–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!</h3>
            <a class="neo-button" href="{{ url_for('static', filename='model.glb') }}" download>üì• –°–∫–∞—á–∞—Ç—å 3D –º–æ–¥–µ–ª—å (.glb)</a>
          </div>
          {% elif error %}
          <div class="result-block error">
            <h3>‚ùå –û—à–∏–±–∫–∞:</h3>
            <p>{{ error }}</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    
    
    <a href="/studio" class="hero-banner clickable-banner">
    </a>
    <!-- –°–ï–ö–¶–ò–Ø –ö–ê–†–£–°–ï–õ–¨ –¢–û–í–ê–†–û–í -->
    <section class="carousel-section">
      <button class="carousel-btn left" onclick="scrollCarousel('product-carousel', -1)">‚Äπ</button>
  
      <div class="carousel-container" id="product-carousel">
        {% for product in carousel_products %}
        <div class="carousel-product-card"
     data-product-id="{{ product.id }}"
     onclick="handleCardClick(event)">
                  <div class="carousel-img-card">
            <img src="{{ product.thumbnail }}" alt="{{ product.translated_title }}">
          </div>
          <div class="carousel-info-card">
            <p><strong>{{ product.translated_title }}</strong></p>
            <p>–¶–µ–Ω–∞: {{ product.price }} —Ä</p>
          </div>
          <div class="carousel-add-cart" data-id="{{ product.id }}">–í –∫–æ—Ä–∑–∏–Ω—É</div>
        </div>
        {% endfor %}
      </div>
  
      <button class="carousel-btn right" onclick="scrollCarousel('product-carousel', 1)">‚Ä∫</button>
  
      <div class="dots">
        {% for i in range(carousel_products|length // 3 + 1) %}
          <span class="dot {% if i == 0 %}active{% endif %}"></span>
        {% endfor %}
      </div>
    </section>
    
    <!-- –°–ï–ö–¶–ò–Ø –ü–û–î–ë–û–†–ö–ò –û–ë–†–ê–ó–û–í -->
    <section class="looks-section">
      <h2>–ü–æ–¥–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤</h2>
      <p class="subtitle">–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –≤–∞—à–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–∞—Ö.</p>
      <div class="looks-grid">
        <div class="look-card" onclick="openLookModal(0)">
          <div class="head">–õ–µ—Ç–Ω–∏–π –æ–±—Ä–∞–∑</div>
          <div class="look-img" style="background-image: url('/static/img/look1.jpg');"></div>
          <div class="content">–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞ ‚Äî —Å—Ç–∏–ª—å, —Ü–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –∏ —Ç.–¥.</div>
        </div>
  
        <div class="look-card" onclick="openLookModal(1)">
          <div class="head">–ì–æ—Ä–æ–¥—Å–∫–æ–π —Å—Ç–∏–ª—å</div>
          <div class="look-img" style="background-image: url('/static/img/look2.jpg');"></div>
          <div class="content">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏ –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ç–∏–ª—å ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≥–æ—Ä–æ–¥—Å–∫–æ–≥–æ –ª—É–∫–∞.</div>
        </div>
  
        <div class="look-card" onclick="openLookModal(2)">
          <div class="head">–Ø—Ä–∫–∏–π –∞–∫—Ü–µ–Ω—Ç</div>
          <div class="look-img" style="background-image: url('/static/img/look3.jpg');"></div>
          <div class="content">–°–≤–µ–∂–∏–π –æ–±—Ä–∞–∑ —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã –∏ —è—Ä–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã.</div>
        </div>
      </div>
    </section>
  
    <div id="look-modal" class="popup hidden" onclick="closeLookModal(event)">
      <div class="popup-content">
        <h3 id="look-modal-title"></h3>
        <img id="look-modal-img" src="" alt="" style="max-width: 100%; margin: 15px 0;">
        <p id="look-modal-description" style="margin: 10px 0 20px;"></p>
        <div class="carousel-container" id="look-modal-products"></div>
        <button class="neo-button" onclick="closeLookModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
 
    <div id="product-modal" class="popup hidden" onclick="closeProductModal(event)">
      <div class="popup-content">
        <h3 id="modal-title"></h3>
        <img id="modal-img" src="" alt="" style="max-width: 100%; margin: 15px 0;">
        <p id="modal-description" style="margin: 10px 0;"></p>
    
        <!-- –¶–µ–Ω–∞ -->
        <p id="modal-price" style="font-weight: bold; font-size: 18px; margin-bottom: 10px;">–¶–µ–Ω–∞: 0 ‚ÇΩ</p>
    
        <!-- –í—ã–±–æ—Ä —Ä–∞–∑–º–µ—Ä–∞ (–±—É–¥–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏) -->
        <div id="size-container" style="margin-bottom: 20px; display: none;">
          <label for="modal-size" style="font-weight: bold;">–†–∞–∑–º–µ—Ä:</label>
          <select id="modal-size" style="margin-top: 5px; padding: 5px; border: 1px solid #ccc; border-radius: 5px;"></select>
        </div>
    
        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="modal-buttons">
          <button class="neo-button" id="modal-cart-btn">–í –∫–æ—Ä–∑–∏–Ω—É</button>
          <button class="neo-button" onclick="closeProductModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
      </div>
    </div>
  
  <script>
  const looks = [
    {
      title: '–õ–µ—Ç–Ω–∏–π –æ–±—Ä–∞–∑',
      description: '–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞ ‚Äî —Å—Ç–∏–ª—å, —Ü–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –∏ —Ç.–¥.',
      image: '/static/img/look1.jpg',
      products: getRandomProducts(3)
    },
    {
      title: '–ì–æ—Ä–æ–¥—Å–∫–æ–π —Å—Ç–∏–ª—å',
      description: '–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏ –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ç–∏–ª—å ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≥–æ—Ä–æ–¥—Å–∫–æ–≥–æ –ª—É–∫–∞.',
      image: '/static/img/look2.jpg',
      products: getRandomProducts(3)
    },
    {
      title: '–Ø—Ä–∫–∏–π –∞–∫—Ü–µ–Ω—Ç',
      description: '–°–≤–µ–∂–∏–π –æ–±—Ä–∞–∑ —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã –∏ —è—Ä–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã.',
      image: '/static/img/look3.jpg',
      products: getRandomProducts(3)
    }
  ];
  
  function getRandomProducts(count) {
    if (!window.allProducts || !Array.isArray(window.allProducts)) return [];
    const shuffled = [...window.allProducts].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, count);
  }
  
  function openLookModal(index) {
    const look = looks[index];
    document.getElementById('look-modal-title').textContent = look.title;
    document.getElementById('look-modal-description').textContent = look.description;
    document.getElementById('look-modal-img').src = look.image;
  
    const container = document.getElementById('look-modal-products');
    container.innerHTML = '';
  
    look.products.forEach(product => {
      const card = document.createElement('div');
      card.className = 'carousel-product-card';
      card.innerHTML = `
        <div class="carousel-img-card">
          <img src="${product.thumbnail}" alt="${product.title}">
        </div>
        <div class="carousel-info-card">
          <p><strong>${product.title}</strong></p>
          <p>–¶–µ–Ω–∞: ${product.price} ‚ÇΩ</p>
        </div>
        <div class="carousel-add-cart" data-id="${product.id}" onclick="addToCart('${product.id}')">–í –∫–æ—Ä–∑–∏–Ω—É</div>
      `;
      container.appendChild(card);
    });
  
    document.getElementById('look-modal').classList.remove('hidden');
  }
  
  function closeLookModal(event) {
    if (!event || event.target.id === 'look-modal') {
      document.getElementById('look-modal').classList.add('hidden');
    }
  }
  
  document.addEventListener('DOMContentLoaded', () => {
  const jsonEl = document.getElementById('all-products-json');
  window.allProducts = JSON.parse(jsonEl.textContent);
});


  </script>
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Three.js –∏ OBJLoader -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r148/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.148.0/examples/js/loaders/OBJLoader.js"></script>
<script id="all-products-json" type="application/json">
  {{ carousel_products | tojson }}
</script>
<script>
  const scene = new THREE.Scene();

  const camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);
  camera.position.set(0, 1.5, 3); // –¥–∞–ª—å—à–µ –∏ –≤—ã—à–µ ‚Äî –ª—É—á—à–µ –≤–∏–¥–Ω–æ

  const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
  renderer.setSize(180, 180);
  document.getElementById('model-viewer').appendChild(renderer.domElement);

  // –û—Å–≤–µ—â–µ–Ω–∏–µ
  const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
  scene.add(ambientLight);

  const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
  directionalLight.position.set(2, 3, 2);
  scene.add(directionalLight);

  // –ó–∞–≥—Ä—É–∑–∫–∞ OBJ
  const loader = new THREE.OBJLoader();
  loader.load(
    "{{ url_for('static', filename='models/model.obj') }}",
    function (object) {
      object.scale.set(2, 2, 2);
      object.position.y = -0.5;

      object.traverse(function (child) {
        if (child instanceof THREE.Mesh) {
          child.material = new THREE.MeshStandardMaterial({ color: 0x555555 });
        }
      });

      scene.add(object);

      function animate() {
        requestAnimationFrame(animate);
        object.rotation.y += 0.01;
        renderer.render(scene, camera);
      }
      animate();
    },
    undefined,
    function (error) {
      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ OBJ:", error);
    }
  );
</script>
<script>
  // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è model-viewer (–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ–¥–≥—Ä—É–∑–∫—É)
  document.addEventListener("DOMContentLoaded", () => {
    const viewer = document.querySelector("model-viewer");
    if (viewer) {
      viewer.setAttribute("reveal", "auto");
      viewer.style.display = "block";
    }
  });
  </script>
   
      <script>
         let currentSlide = 0;
  let slidesPerPage = 1;
  let totalPages = 1;

  function calculateSlides() {
    const container = document.getElementById('product-carousel');
    const cards = container.querySelectorAll('.carousel-product-card');
    const containerWidth = container.offsetWidth;
    const cardWidth = cards[0]?.offsetWidth || 200;

    slidesPerPage = Math.floor(containerWidth / (cardWidth + 20)); // 20 ‚Äî gap
    totalPages = Math.ceil(cards.length / slidesPerPage);
    updateDots();
  }

  function scrollCarousel(id, direction) {
    const container = document.getElementById(id);
    const card = container.querySelector('.carousel-product-card');
    if (!card) return;

    const cardWidth = card.offsetWidth + 20; // —É—á—ë—Ç –æ—Ç—Å—Ç—É–ø–∞ –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
    currentSlide += direction;
    currentSlide = Math.max(0, Math.min(currentSlide, totalPages - 1));

    container.scrollTo({
      left: currentSlide * cardWidth * slidesPerPage,
      behavior: 'smooth'
    });

    updateDots();
  }

  function updateDots() {
    const dots = document.querySelectorAll('.dot');
    dots.forEach((dot, index) => {
      dot.classList.toggle('active', index === currentSlide);
    });
  }

  function createDots() {
    const dotsContainer = document.querySelector('.dots');
    dotsContainer.innerHTML = '';

    for (let i = 0; i < totalPages; i++) {
      const dot = document.createElement('span');
      dot.classList.add('dot');
      if (i === 0) dot.classList.add('active');
      dot.addEventListener('click', () => {
        scrollCarousel('product-carousel', i - currentSlide);
      });
      dotsContainer.appendChild(dot);
    }
  }

  window.addEventListener('resize', () => {
    calculateSlides();
    createDots();
  });

  document.addEventListener('DOMContentLoaded', () => {
    calculateSlides();
    createDots();
    setInterval(() => scrollCarousel('product-carousel', 1), 6000);
  });
        
        // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞
        function startAutoScroll() {
          stopAutoScroll();
          autoScrollInterval = setInterval(() => {
            scrollCarousel(1);
            if (currentSlide >= slides.length - slidesToShow) currentSlide = -1;
          }, 5000);
        }
        function stopAutoScroll() {
          clearInterval(autoScrollInterval);
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É
        
        
        document.addEventListener('DOMContentLoaded', () => {
          updateDots();
          startAutoScroll();
        
          // –ö–ª–∏–∫ –ø–æ —Ç–æ—á–∫–∞–º (–µ—Å–ª–∏ –Ω–∞–¥–æ)
          dots.forEach((dot, i) => {
            dot.addEventListener('click', () => {
              currentSlide = i;
              scrollCarousel(0);
              stopAutoScroll(); // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É
              startAutoScroll();
            });
          });
        });
        </script>
      
     
      
     <script>
  let products = {{ carousel_products | tojson | safe }};

  function openModalFromElement(card) {
    const id = card.dataset.productId;
    const product = products.find(p => p.id == id);
    if (!product) return;
    openProductModal(product);
  }

  function openProductModal(product) {
  const modal = document.getElementById('product-modal');
  document.getElementById('modal-title').textContent = product.translated_title;
  document.getElementById('modal-img').src = product.thumbnail;
  document.getElementById('modal-description').textContent = product.translated_description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';

  const cartBtn = document.getElementById('modal-cart-btn');
  cartBtn.textContent = '–í –∫–æ—Ä–∑–∏–Ω—É';
  cartBtn.classList.remove('added');

  cartBtn.onclick = () => {
    addToCart(product.id);
    cartBtn.textContent = '–í –∫–æ—Ä–∑–∏–Ω–µ';
    cartBtn.classList.add('added');
  };

  modal.classList.remove('hidden');
}

  function closeProductModal(e) {
    if (!e || e.target.id === 'product-modal') {
      document.getElementById('product-modal').classList.add('hidden');
    }
  }

  function addToCart(id) {
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const existing = cart.find(item => item.id === id);
    if (existing) {
      existing.quantity++;
    } else {
      cart.push({
  id: product.id,
  title: product.translated_title || product.title,
  price: product.price,
  size: selectedSize,
  quantity: 1
});
    }
    localStorage.setItem('cart', JSON.stringify(cart));
    updateAllButtons();
  }
  function handleCardClick(event) {
  const id = event.currentTarget.dataset.productId;
  const product = window.allProducts.find(p => p.id == id);
  if (product) openProductModal(product);
}


  function updateAllButtons() {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    document.querySelectorAll('.carousel-add-cart').forEach(btn => {
      const id = btn.dataset.id;
      if (id && cart.some(item => item.id === id)) {
        btn.textContent = '–í –∫–æ—Ä–∑–∏–Ω–µ';
      }
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    updateAllButtons();
    document.querySelectorAll('.carousel-add-cart').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const id = btn.dataset.id;
        addToCart(id);
        btn.textContent = '–í –∫–æ—Ä–∑–∏–Ω–µ';
      });
    });
  });
</script>
      
      <script id="all-products-json" type="application/json">
        {{ carousel_products | tojson }}
      </script>
      
      <script>
      document.addEventListener('DOMContentLoaded', () => {
        const jsonEl = document.getElementById('all-products-json');
        const products = JSON.parse(jsonEl.textContent);
      
        // –ù–∞–∑–Ω–∞—á–∞–µ–º –∫–ª–∏–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
        document.querySelectorAll('.carousel-product-card').forEach(card => {
          card.addEventListener('click', () => {
            const id = card.getAttribute('data-product-id');
            const product = products.find(p => p.id == id);
            if (product) showProductModal(product);
          });
        });
      
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã
        updateAllCartButtons();
      });
      
      function showProductModal(product) {
  document.getElementById('modal-title').textContent = product.translated_title;
  document.getElementById('modal-img').src = product.thumbnail;
  document.getElementById('modal-description').textContent = product.translated_description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';

  const btn = document.getElementById('modal-cart-btn');
  btn.textContent = '–í –∫–æ—Ä–∑–∏–Ω—É';
  btn.classList.remove('added');
  btn.onclick = () => {
    addToCart(product.id);
    btn.textContent = '–í –∫–æ—Ä–∑–∏–Ω–µ';
    btn.classList.add('added');
  };

  document.getElementById('product-modal').classList.remove('hidden');
}
      
      function closeProductModal(e) {
        if (!e || e.target.id === 'product-modal') {
          document.getElementById('product-modal').classList.add('hidden');
        }
      }
      
      function addToCart(id) {
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const existing = cart.find(p => p.id == id);
        if (existing) {
          existing.quantity += 1;
        } else {
          cart.push({
  id: product.id,
  title: product.translated_title || product.title,
  price: product.price,
  size: selectedSize,
  quantity: 1
});
        }
        localStorage.setItem('cart', JSON.stringify(cart));
        updateAllCartButtons();
      }
      function openProductModal(product) {
  document.getElementById("modal-title").textContent = product.title;
  document.getElementById("modal-img").src = product.image;
  document.getElementById("modal-description").textContent = product.description;
  document.getElementById("modal-price").textContent = `–¶–µ–Ω–∞: ${product.price} ‚ÇΩ`;

  // –ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–ª–∏ –∏–∑ localStorage

  document.getElementById("product-modal").classList.remove("hidden");
}
      function updateAllCartButtons() {
        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
        document.querySelectorAll('.carousel-add-cart').forEach(btn => {
          const id = btn.dataset.id;
          if (cart.some(p => p.id == id)) {
            btn.textContent = '–í –∫–æ—Ä–∑–∏–Ω–µ';
          }
        });
      }
      </script>
      <script>
        function openProductModal(product) {
          const modal = document.getElementById('product-modal');
          document.getElementById('modal-title').textContent = product.translated_title || product.title;
          document.getElementById('modal-img').src = product.thumbnail || product.image;
          document.getElementById('modal-description').textContent = product.translated_description || product.description || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
          document.getElementById('modal-price').textContent = `–¶–µ–Ω–∞: ${product.price} ‚ÇΩ`;
        
          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ä–∞–∑–º–µ—Ä–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
          const sizeContainer = document.getElementById('size-container');
          const sizeSelect = document.getElementById('modal-size');
          const lowerTitle = (product.title || '').toLowerCase(); // ‚¨ÖÔ∏è –æ—Å—Ç–∞–≤—å —Ç–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
let sizes = [];

if (
  lowerTitle.includes('shoes') ||
  lowerTitle.includes('sneaker') ||
  lowerTitle.includes('nike') ||
  lowerTitle.includes('rider') ||
  lowerTitle.includes('slipper')
) {
  sizes = ['36', '37', '38', '39', '40', '41', '42', '43', '44'];
} else if (
  lowerTitle.includes('watch')
) {
  sizes = ['S', 'M', 'L'];
} else if (
  lowerTitle.includes('shirt') ||
  lowerTitle.includes('tshirt') ||
  lowerTitle.includes('jacket') ||
  lowerTitle.includes('coat') ||
  lowerTitle.includes('dress') ||
  lowerTitle.includes('hoodie') ||
  lowerTitle.includes('clothing') ||
  lowerTitle.includes('suit') ||
  lowerTitle.includes('skirt') ||
  lowerTitle.includes('gown')
) {
  sizes = ['XS', 'S', 'M', 'L', 'XL'];
}
        
          sizeSelect.innerHTML = '';
          sizes.forEach(s => {
            const option = document.createElement('option');
            option.value = s;
            option.textContent = s;
            sizeSelect.appendChild(option);
          });
        
          sizeContainer.style.display = 'block';
        
          // –ö–Ω–æ–ø–∫–∞ "–≤ –∫–æ—Ä–∑–∏–Ω—É"
          const cartBtn = document.getElementById('modal-cart-btn');
          cartBtn.textContent = '–í –∫–æ—Ä–∑–∏–Ω—É';
          cartBtn.classList.remove('added');
          cartBtn.onclick = () => {
            const size = sizeSelect.value;
            addToCart(product.id, size);
            cartBtn.textContent = '–í –∫–æ—Ä–∑–∏–Ω–µ';
            cartBtn.classList.add('added');
          };
        
          modal.classList.remove('hidden');
        }
        
        function addToCart(id, size) {
          let cart = JSON.parse(localStorage.getItem('cart') || '[]');
          const existing = cart.find(item => item.id === id && item.size === size);
          if (existing) {
            existing.quantity++;
          } else {
            cart.push({
  id: product.id,
  title: product.translated_title || product.title,
  price: product.price,
  size: selectedSize,
  quantity: 1
});
          }
          localStorage.setItem('cart', JSON.stringify(cart));
          updateAllButtons();
        }
        </script>
              {% endblock %}
